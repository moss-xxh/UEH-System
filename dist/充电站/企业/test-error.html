<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>错误检测</title>
</head>
<body>
    <h1>JavaScript错误检测</h1>
    <pre id="log" style="background: #f0f0f0; padding: 20px;"></pre>
    
    <script>
        const logEl = document.getElementById('log');
        let errorFound = false;
        
        // 捕获所有错误
        window.addEventListener('error', function(e) {
            errorFound = true;
            const msg = `
❌ JavaScript错误捕获:
   消息: ${e.message}
   文件: ${e.filename}
   行号: ${e.lineno}
   列号: ${e.colno}
            `;
            logEl.textContent += msg;
            console.error('错误详情:', e);
            return true;
        });
        
        // 记录脚本加载开始
        logEl.textContent = '开始加载 enterprise-enhanced.js...\n';
    </script>
    
    <!-- 加载主文件 -->
    <script src="js/enterprise-enhanced.js"></script>
    
    <script>
        // 检查加载结果
        setTimeout(() => {
            if (!errorFound) {
                logEl.textContent += '\n✅ 没有检测到JavaScript错误\n';
            }
            
            logEl.textContent += '\n检查对象状态:\n';
            logEl.textContent += `  typeof EnterpriseSystem: ${typeof EnterpriseSystem}\n`;
            logEl.textContent += `  typeof system: ${typeof system}\n`;
            
            // 尝试手动创建
            if (typeof EnterpriseSystem === 'function' && typeof system === 'undefined') {
                logEl.textContent += '\n尝试手动创建 system 对象...\n';
                try {
                    window.system = new EnterpriseSystem();
                    logEl.textContent += '✅ 成功创建 system 对象\n';
                    
                    // 测试方法
                    if (typeof system.showDeviceDetail === 'function') {
                        logEl.textContent += '✅ showDeviceDetail 方法可用\n';
                        
                        // 测试调用
                        logEl.textContent += '\n测试调用 showDeviceDetail("DEV001")...\n';
                        system.showDeviceDetail('DEV001');
                        
                        setTimeout(() => {
                            const modal = document.querySelector('.modal-overlay');
                            if (modal) {
                                logEl.textContent += '✅ 弹窗成功创建！\n';
                                modal.remove();
                            } else {
                                logEl.textContent += '❌ 弹窗未创建\n';
                            }
                        }, 100);
                    }
                } catch (e) {
                    logEl.textContent += `❌ 创建失败: ${e.message}\n`;
                    logEl.textContent += `堆栈: ${e.stack}\n`;
                }
            }
        }, 100);
    </script>
</body>
</html>