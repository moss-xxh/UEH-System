# 充电站SaaS系统需求文档

## 1. 文档信息

- **文档版本**: v1.0.0
- **创建日期**: 2025-08-19
- **作者**: 系统架构团队
- **状态**: 审核中

## 2. 项目概述

### 2.1 项目背景

随着电动汽车市场的快速增长，充电基础设施的管理成为一个关键挑战。目前市场上存在以下问题：
- 充电网络运营商使用碎片化的管理软件
- 定制软件开发成本高昂，维护困难
- 终端用户体验不统一，缺乏标准化服务
- 运营数据分散，难以进行有效的业务分析

### 2.2 项目目标

构建一个多租户的充电站SaaS平台，实现：
- **统一管理**: 为充电运营商提供一站式管理解决方案
- **白标服务**: 支持企业定制品牌的管理门户和用户App
- **标准化接入**: 支持OCPP等行业标准协议
- **数据驱动**: 提供全面的数据分析和业务洞察

### 2.3 项目范围

本系统包含三个核心层级：
1. **平台管理层**: SaaS平台的超级管理后台
2. **企业管理层**: 充电公司的运营管理门户
3. **用户应用层**: 电动车主的移动应用程序

## 3. 用户角色定义

### 3.1 平台管理员 (Platform Admin)

**职责**:
- 管理所有租户账户
- 监控平台整体运行状况
- 配置系统级参数
- 处理技术支持升级

**权限**:
- 创建/修改/删除租户账户
- 访问所有系统数据（脱敏）
- 配置系统参数
- 查看平台级分析报表

### 3.2 企业管理员 (Company Admin)

**职责**:
- 管理本企业充电站网络
- 配置充电桩参数
- 管理企业用户权限
- 监控运营数据

**权限**:
- 完全控制本企业数据
- 创建/管理企业操作员账户
- 配置充电站和充电桩
- 查看企业运营报表

### 3.3 企业操作员 (Company Operator)

**职责**:
- 日常运营管理
- 处理充电故障
- 协助用户支持
- 监控充电状态

**权限**:
- 查看充电站状态
- 处理充电异常
- 查看充电记录
- 基础数据维护

### 3.4 电动车主 (EV Driver)

**职责**:
- 查找充电站
- 启动/停止充电
- 管理支付方式
- 查看充电历史

**权限**:
- 访问公开充电站信息
- 管理个人账户
- 查看个人充电记录
- 管理支付方式

## 4. 功能需求

### 4.1 平台管理后台

#### 4.1.1 租户管理

**功能描述**: 管理SaaS平台上的所有租户企业

**详细需求**:
- FR-ADM-001: 系统必须支持创建新租户，包含企业名称、联系方式、服务套餐等信息
- FR-ADM-002: 系统必须支持编辑租户信息，包括状态（活跃/暂停/禁用）
- FR-ADM-003: 系统必须支持查看租户详情，包括使用统计、账单信息
- FR-ADM-004: 系统必须支持批量操作，如批量续费、批量通知
- FR-ADM-005: 系统必须记录所有租户操作的审计日志

#### 4.1.2 系统监控

**功能描述**: 实时监控平台运行状况

**详细需求**:
- FR-ADM-006: 系统必须显示实时在线充电桩数量
- FR-ADM-007: 系统必须显示当前充电会话数
- FR-ADM-008: 系统必须提供系统健康度指标（CPU、内存、响应时间）
- FR-ADM-009: 系统必须支持告警配置和通知
- FR-ADM-010: 系统必须提供历史数据趋势分析

#### 4.1.3 财务管理

**功能描述**: 管理租户订阅和账单

**详细需求**:
- FR-ADM-011: 系统必须支持多种订阅套餐配置
- FR-ADM-012: 系统必须自动生成月度账单
- FR-ADM-013: 系统必须支持在线支付和发票管理
- FR-ADM-014: 系统必须提供收入报表和分析
- FR-ADM-015: 系统必须支持优惠券和促销管理

### 4.2 企业管理门户

#### 4.2.1 充电站管理

**功能描述**: 管理企业的充电站网络

**详细需求**:
- FR-COM-001: 系统必须支持添加新充电站，包含名称、地址、GPS坐标
- FR-COM-002: 系统必须支持编辑充电站信息，包括营业时间、停车费用
- FR-COM-003: 系统必须支持充电站分组管理（如按区域、类型）
- FR-COM-004: 系统必须在地图上显示所有充电站位置
- FR-COM-005: 系统必须支持批量导入充电站数据（CSV/Excel）

#### 4.2.2 充电桩管理

**功能描述**: 管理充电站内的充电桩设备

**详细需求**:
- FR-COM-006: 系统必须支持添加充电桩，包含型号、功率、连接器类型
- FR-COM-007: 系统必须实时显示充电桩状态（可用/充电中/故障/维护）
- FR-COM-008: 系统必须支持远程控制充电桩（启动/停止/重启）
- FR-COM-009: 系统必须记录充电桩维护历史
- FR-COM-010: 系统必须支持充电桩固件远程升级

#### 4.2.3 价格管理

**功能描述**: 配置充电服务定价策略

**详细需求**:
- FR-COM-011: 系统必须支持多种计费模式（按时间/按电量/阶梯定价）
- FR-COM-012: 系统必须支持分时定价（峰谷平时段）
- FR-COM-013: 系统必须支持会员优惠价格
- FR-COM-014: 系统必须支持停车费设置
- FR-COM-015: 系统必须支持价格变更预告和生效时间设置

#### 4.2.4 用户管理

**功能描述**: 管理企业的终端用户

**详细需求**:
- FR-COM-016: 系统必须显示注册用户列表
- FR-COM-017: 系统必须支持用户分组（普通/VIP/企业用户）
- FR-COM-018: 系统必须支持用户账户冻结/解冻
- FR-COM-019: 系统必须支持查看用户充电历史
- FR-COM-020: 系统必须支持批量发送通知消息

#### 4.2.5 数据分析

**功能描述**: 提供运营数据分析和报表

**详细需求**:
- FR-COM-021: 系统必须提供充电量统计（日/周/月/年）
- FR-COM-022: 系统必须提供收入分析报表
- FR-COM-023: 系统必须提供充电桩利用率分析
- FR-COM-024: 系统必须提供用户行为分析
- FR-COM-025: 系统必须支持自定义报表和数据导出

### 4.3 用户移动应用

#### 4.3.1 用户注册与认证

**功能描述**: 用户账户管理

**详细需求**:
- FR-APP-001: 系统必须支持手机号/邮箱注册
- FR-APP-002: 系统必须支持第三方登录（微信/支付宝）
- FR-APP-003: 系统必须支持实名认证
- FR-APP-004: 系统必须支持找回密码功能
- FR-APP-005: 系统必须支持生物识别登录（指纹/面部）

#### 4.3.2 充电站查找

**功能描述**: 帮助用户找到合适的充电站

**详细需求**:
- FR-APP-006: 系统必须在地图上显示附近充电站
- FR-APP-007: 系统必须显示充电站实时状态（可用桩数量）
- FR-APP-008: 系统必须支持按条件筛选（距离/价格/功率/连接器类型）
- FR-APP-009: 系统必须提供导航功能
- FR-APP-010: 系统必须支持收藏常用充电站

#### 4.3.3 充电服务

**功能描述**: 核心充电功能

**详细需求**:
- FR-APP-011: 系统必须支持扫码启动充电
- FR-APP-012: 系统必须实时显示充电状态（电量/时间/费用）
- FR-APP-013: 系统必须支持远程停止充电
- FR-APP-014: 系统必须在充电完成时发送通知
- FR-APP-015: 系统必须支持预约充电功能

#### 4.3.4 支付管理

**功能描述**: 支付和账户余额管理

**详细需求**:
- FR-APP-016: 系统必须支持绑定银行卡/信用卡
- FR-APP-017: 系统必须支持第三方支付（微信/支付宝）
- FR-APP-018: 系统必须支持账户充值和余额支付
- FR-APP-019: 系统必须提供电子发票
- FR-APP-020: 系统必须支持自动扣费设置

#### 4.3.5 个人中心

**功能描述**: 用户个人信息和历史记录

**详细需求**:
- FR-APP-021: 系统必须显示充电历史记录
- FR-APP-022: 系统必须提供充电统计（月度/年度）
- FR-APP-023: 系统必须支持车辆信息管理
- FR-APP-024: 系统必须提供消费明细和账单
- FR-APP-025: 系统必须支持意见反馈和客服

## 5. 非功能需求

### 5.1 性能需求

- NFR-001: 系统必须支持至少10,000个并发用户
- NFR-002: API响应时间P95必须小于200ms
- NFR-003: 移动应用启动时间必须小于3秒
- NFR-004: 地图加载时间必须小于2秒
- NFR-005: 充电启动响应时间必须小于5秒

### 5.2 可用性需求

- NFR-006: 系统可用性必须达到99.9%（每月停机时间不超过43分钟）
- NFR-007: 计划维护窗口必须在凌晨2-5点
- NFR-008: 系统必须支持灰度发布
- NFR-009: 系统必须支持自动故障转移
- NFR-010: 数据库必须支持主从复制

### 5.3 安全需求

- NFR-011: 所有API通信必须使用HTTPS
- NFR-012: 用户密码必须使用bcrypt加密存储
- NFR-013: 支付信息必须符合PCI DSS标准
- NFR-014: 系统必须实施多因素认证（企业管理员）
- NFR-015: 系统必须记录所有安全相关事件

### 5.4 可扩展性需求

- NFR-016: 系统架构必须支持水平扩展
- NFR-017: 系统必须支持至少1000家租户企业
- NFR-018: 系统必须支持至少100万注册用户
- NFR-019: 系统必须支持至少10万个充电桩
- NFR-020: 数据存储必须支持分片

### 5.5 兼容性需求

- NFR-021: Web应用必须支持Chrome、Safari、Firefox、Edge最新版本
- NFR-022: 移动应用必须支持iOS 14+和Android 8+
- NFR-023: 系统必须支持OCPP 1.6J和2.0.1协议
- NFR-024: API必须提供向后兼容至少2个版本
- NFR-025: 系统必须支持国际化（中文/英文）

## 6. 接口需求

### 6.1 充电桩通信接口

**协议**: OCPP (Open Charge Point Protocol)

**支持版本**:
- OCPP 1.6J (JSON over WebSocket)
- OCPP 2.0.1 (未来支持)

**核心消息类型**:
- BootNotification: 充电桩上线通知
- StatusNotification: 状态变更通知
- StartTransaction: 开始充电事务
- StopTransaction: 结束充电事务
- MeterValues: 电表数值上报
- RemoteStartTransaction: 远程启动充电
- RemoteStopTransaction: 远程停止充电

### 6.2 第三方支付接口

**支付渠道**:
- Stripe API (国际支付)
- 微信支付 API
- 支付宝 API

**接口功能**:
- 创建支付订单
- 查询支付状态
- 退款处理
- 对账文件下载

### 6.3 地图服务接口

**服务提供商**:
- Google Maps API (国际)
- 高德地图 API (国内)

**接口功能**:
- 地理编码/反地理编码
- 路径规划
- POI搜索
- 实时交通信息

### 6.4 消息推送接口

**推送服务**:
- FCM (Firebase Cloud Messaging) for Android
- APNs (Apple Push Notification service) for iOS

**消息类型**:
- 充电开始/结束通知
- 充电异常告警
- 账户余额提醒
- 营销推广消息

## 7. 数据需求

### 7.1 数据存储需求

- 用户数据保留期限: 永久（除非用户要求删除）
- 充电记录保留期限: 5年
- 系统日志保留期限: 90天
- 审计日志保留期限: 3年
- 数据备份频率: 每日增量备份，每周全量备份

### 7.2 数据隐私需求

- 符合GDPR（欧盟）要求
- 符合个人信息保护法（中国）要求
- 支持用户数据导出
- 支持用户数据删除（忘记权）
- 数据脱敏处理（日志、分析）

### 7.3 数据分析需求

**实时数据**:
- 充电桩在线状态
- 当前充电会话
- 系统负载指标

**历史数据分析**:
- 充电量趋势分析
- 用户行为分析
- 收入分析
- 设备利用率分析
- 故障率分析

## 8. 业务规则

### 8.1 充电规则

- BR-001: 用户必须完成实名认证才能使用充电服务
- BR-002: 充电前必须检查账户余额或绑定支付方式
- BR-003: 单次充电最长时限为24小时
- BR-004: 充电完成后15分钟内必须移车，否则收取占位费
- BR-005: 故障充电桩自动标记为不可用状态

### 8.2 计费规则

- BR-006: 计费精度为0.01元
- BR-007: 电量计量精度为0.01kWh
- BR-008: 最低消费金额为1元
- BR-009: 预授权金额为预计充电费用的150%
- BR-010: 退款必须在3个工作日内处理

### 8.3 会员规则

- BR-011: VIP会员享受充电费用9折优惠
- BR-012: 月充电量超过500kWh自动升级为VIP
- BR-013: 连续3个月无充电记录降级为普通会员
- BR-014: 企业用户可设置月度充电额度
- BR-015: 积分可用于抵扣充电费用（100积分=1元）

## 9. 约束条件

### 9.1 技术约束

- 必须使用React/Next.js构建Web前端
- 必须使用React Native构建移动应用
- 必须使用Node.js/NestJS构建后端
- 必须使用PostgreSQL作为主数据库
- 必须采用微服务架构

### 9.2 业务约束

- MVP版本必须在6个月内上线
- 初期预算限制在500万人民币
- 必须优先支持中国市场
- 必须符合当地充电行业标准
- 必须通过相关安全认证

### 9.3 法规约束

- 必须符合数据隐私法规
- 必须符合支付行业PCI DSS标准
- 必须符合电力行业安全规范
- 必须提供合规的发票和税务处理
- 必须支持监管部门的数据上报

## 10. 验收标准

### 10.1 功能验收

- 所有核心功能必须通过功能测试
- 用户界面必须符合设计规范
- 所有API接口必须通过集成测试
- 充电流程必须端到端测试通过

### 10.2 性能验收

- 负载测试: 支持10,000并发用户
- 压力测试: 系统在150%负载下稳定运行
- 响应时间: 95%的API请求响应时间<200ms
- 可用性: 连续运行30天可用性>99.9%

### 10.3 安全验收

- 通过安全渗透测试
- 通过OWASP Top 10安全检查
- 支付流程通过PCI DSS认证
- 数据加密和传输安全验证

### 10.4 用户验收

- 内部测试: 100名员工测试通过
- Beta测试: 500名真实用户测试
- 用户满意度: NPS分数>50
- Bug修复率: P1问题24小时内修复

## 11. 风险评估

### 11.1 技术风险

| 风险项 | 可能性 | 影响 | 缓解措施 |
|-------|--------|------|----------|
| OCPP协议兼容性问题 | 高 | 高 | 建立充电桩测试实验室，提前测试主流设备 |
| 系统扩展性不足 | 中 | 高 | 采用云原生架构，使用Kubernetes进行容器编排 |
| 第三方服务依赖 | 中 | 中 | 实现服务降级策略，准备备用方案 |
| 数据迁移复杂 | 低 | 高 | 制定详细的数据迁移计划和回滚方案 |

### 11.2 业务风险

| 风险项 | 可能性 | 影响 | 缓解措施 |
|-------|--------|------|----------|
| 市场接受度低 | 中 | 高 | 进行市场调研，MVP快速验证 |
| 竞争对手反应 | 高 | 中 | 差异化定位，快速迭代 |
| 政策法规变化 | 中 | 高 | 保持架构灵活性，关注政策动向 |
| 运营成本超支 | 中 | 中 | 采用按需付费的云服务，优化资源使用 |

## 12. 项目里程碑

### Phase 1: 基础设施搭建（月1-2）
- 完成技术架构设计
- 搭建开发环境
- 完成CI/CD流程
- 实现用户认证系统

### Phase 2: 核心功能开发（月3-4）
- 完成充电站/桩管理
- 实现OCPP协议接入
- 完成充电流程
- 基础数据分析

### Phase 3: 用户端开发（月5）
- 完成移动App开发
- 实现地图和导航
- 完成支付集成
- 用户测试

### Phase 4: 测试与优化（月6）
- 系统集成测试
- 性能优化
- 安全加固
- Beta测试

### Phase 5: 上线准备（月6末）
- 生产环境部署
- 运维培训
- 文档完善
- 正式发布

## 13. 附录

### 13.1 术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 充电桩 | Charging Pile/Point | 提供充电服务的物理设备 |
| 充电站 | Charging Station | 包含多个充电桩的场地 |
| OCPP | Open Charge Point Protocol | 开放充电点协议 |
| CPO | Charge Point Operator | 充电点运营商 |
| EMSP | E-Mobility Service Provider | 电动汽车服务提供商 |
| SoC | State of Charge | 电池电量状态 |
| RFID | Radio Frequency Identification | 射频识别 |
| kWh | Kilowatt Hour | 千瓦时，电量单位 |

### 13.2 参考文档

- OCPP 1.6 协议规范
- OCPP 2.0.1 协议规范
- PCI DSS 合规指南
- GDPR 合规要求
- 中国个人信息保护法
- 电动汽车充电基础设施技术规范

### 13.3 变更历史

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| 1.0.0 | 2025-08-19 | 初始版本 | 系统架构团队 |

---

*本文档为充电站SaaS系统的详细需求规范，将作为系统设计和开发的基准文档。*