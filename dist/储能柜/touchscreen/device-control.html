<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>储能柜管理系统 - 设备控制</title>
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="tech-ui-enhancement.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            overflow: hidden;
        }

        /* 头部导航 */
        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #0a1628 100%);
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
        }
        
        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 600;
        }

        .cabinet-info {
            margin-left: 40px;
            color: white;
        }

        .cabinet-name {
            font-size: 18px;
            font-weight: 500;
        }

        .cabinet-status {
            font-size: 14px;
            color: #4ade80;
            margin-top: 5px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-time {
            color: white;
            font-size: 16px;
            font-family: 'Helvetica Neue', monospace;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* 主要内容区域 */
        .main-container {
            display: flex;
            height: calc(100vh - 80px);
        }

        /* 侧边导航 */
        .sidebar {
            width: 240px;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            padding: 30px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 30px;
            color: #666;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            font-size: 16px;
        }

        .nav-item:hover {
            background: #f0f2f5;
            color: #1e90ff;
        }

        .nav-item.active {
            background: linear-gradient(90deg, #e3f2fd 0%, transparent 100%);
            color: #1e90ff;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #1e90ff;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* 内容区域 */
        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        /* 控制面板 */
        .control-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            width: 36px;
            height: 36px;
            background: #e3f2fd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1e90ff;
            font-size: 20px;
        }

        /* 运行模式选择 */
        .mode-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-option {
            flex: 1;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mode-option:hover {
            border-color: #1e90ff;
            background: #f0f8ff;
        }

        .mode-option.active {
            border-color: #1e90ff;
            background: #e3f2fd;
        }

        .mode-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .mode-name {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 5px;
        }

        .mode-desc {
            font-size: 14px;
            color: #666;
        }

        /* 控制按钮组 */
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .control-btn {
            padding: 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: #f3f4f6;
            color: #374151;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .control-btn.charge {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
        }

        .control-btn.discharge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .control-btn.stop {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .control-btn.standby {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }

        .control-btn-icon {
            font-size: 32px;
        }

        /* 参数设置 */
        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .param-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .param-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .param-input {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f9fafb;
        }

        .param-input:focus {
            outline: none;
            border-color: #1e90ff;
            background: white;
            box-shadow: 0 0 0 3px rgba(30, 144, 255, 0.1);
        }

        .param-unit {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            pointer-events: none;
        }

        .input-wrapper {
            position: relative;
        }

        /* 峰谷套利时间轴 */
        .timeline-container {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .timeline-header {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            color: #1a1a1a;
        }

        .timeline {
            position: relative;
            height: 80px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

        .time-labels {
            display: flex;
            height: 25px;
            border-bottom: 1px solid #e5e7eb;
        }

        .time-label {
            flex: 1;
            text-align: center;
            font-size: 12px;
            color: #666;
            padding-top: 5px;
            border-right: 1px solid #e5e7eb;
        }

        .time-label:last-child {
            border-right: none;
        }

        .time-blocks {
            display: flex;
            height: 55px;
        }

        .time-block {
            flex: 1;
            border-right: 1px solid #e5e7eb;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .time-block:last-child {
            border-right: none;
        }

        .time-block:hover {
            opacity: 0.8;
        }

        .time-block.peak {
            background: #fee2e2;
        }

        .time-block.valley {
            background: #dbeafe;
        }

        .time-block.normal {
            background: #f3f4f6;
        }

        /* 图例 */
        .timeline-legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
        }

        /* 操作按钮 */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e5e7eb;
        }

        .action-btn {
            padding: 12px 32px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.primary {
            background: #1e90ff;
            color: white;
        }

        .action-btn.primary:hover {
            background: #1873cc;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(30, 144, 255, 0.3);
        }

        .action-btn.secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #e5e7eb;
        }

        .action-btn.secondary:hover {
            background: #e5e7eb;
        }

        /* 状态提示 */
        .status-banner {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 12px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #166534;
        }

        .status-banner.warning {
            background: #fef3c7;
            border-color: #fde68a;
            color: #92400e;
        }

        .status-banner.error {
            background: #fee2e2;
            border-color: #fecaca;
            color: #991b1b;
        }

        /* 响应式设计 - 10.1寸屏幕 */
        @media (max-width: 1280px) and (max-height: 800px) {
            .header {
                height: 60px;
                padding: 0 20px;
            }
            
            .logo-text {
                font-size: 20px;
            }
            
            .sidebar {
                width: 200px;
            }
            
            .nav-item {
                padding: 15px 20px;
                font-size: 14px;
            }
            
            .content {
                padding: 20px;
            }
            
            .control-btn {
                padding: 16px;
                font-size: 14px;
            }
            
            .control-btn-icon {
                font-size: 28px;
            }
        }

        /* 响应式设计 - 13.3寸屏幕 */
        @media (min-width: 1920px) and (min-height: 1080px) {
            .header {
                height: 100px;
                padding: 0 50px;
            }
            
            .logo-text {
                font-size: 28px;
            }
            
            .sidebar {
                width: 280px;
            }
            
            .nav-item {
                padding: 22px 40px;
                font-size: 18px;
            }
            
            .content {
                padding: 40px;
            }
            
            .control-btn {
                padding: 24px;
                font-size: 18px;
            }
            
            .control-btn-icon {
                font-size: 40px;
            }
        }

        /* 确认对话框 */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .confirm-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .confirm-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1a1a1a;
        }

        .confirm-message {
            font-size: 16px;
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .confirm-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .confirm-btn.confirm {
            background: #1e90ff;
            color: white;
        }

        .confirm-btn.confirm:hover {
            background: #1873cc;
        }

        .confirm-btn.cancel {
            background: #f3f4f6;
            color: #374151;
        }

        .confirm-btn.cancel:hover {
            background: #e5e7eb;
        }
    </style>
</head>
<body>
    <!-- 头部导航 -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <div class="logo-icon">
                    <img src="logo.png" alt="Logo">
                </div>
                <div class="logo-text" data-lang="systemName">储能柜管理系统</div>
            </div>
            <div class="cabinet-info">
                <div class="cabinet-name">储能柜 #001</div>
                <div class="cabinet-status">
                    <span data-lang="status">运行正常</span>
                    <span class="status-dot status-normal" style="margin-left: 5px; width: 8px; height: 8px; background: #4ade80; border-radius: 50%; display: inline-block;"></span>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="header-time" id="currentTime">2024-01-31 14:30:00</div>
            <div class="header-buttons">
                <button class="header-btn" onclick="switchTheme()">🎨 <span data-lang="theme">主题</span></button>
                <button class="header-btn" onclick="switchLanguage()">🌐 <span data-lang="language">语言</span></button>
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <div class="main-container">
        <!-- 侧边导航 -->
        <nav class="sidebar">
            <a href="home.html" class="nav-item">
                <span class="nav-icon">🏠</span>
                <span data-lang="navHome">首页</span>
            </a>
            <a href="device-params.html" class="nav-item">
                <span class="nav-icon">📊</span>
                <span data-lang="navParams">设备参数</span>
            </a>
            <a href="device-control.html" class="nav-item active">
                <span class="nav-icon">🎛️</span>
                <span data-lang="navControl">设备控制</span>
            </a>
            <a href="alarms.html" class="nav-item">
                <span class="nav-icon">⚠️</span>
                <span data-lang="navAlarms">告警</span>
            </a>
            <a href="settings.html" class="nav-item">
                <span class="nav-icon">⚙️</span>
                <span data-lang="navSettings">设置</span>
            </a>
        </nav>

        <!-- 内容区域 -->
        <main class="content">
            <!-- 当前状态提示 -->
            <div class="status-banner" id="statusBanner">
                <span>ℹ️</span>
                <span data-lang="autoModeRunning">系统正在自动模式下运行，根据峰谷套利策略自动控制充放电</span>
            </div>

            <!-- 运行模式 -->
            <div class="control-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">🔄</div>
                        <span data-lang="runMode">运行模式</span>
                    </h2>
                </div>
                
                <div class="mode-selector">
                    <div class="mode-option active" onclick="selectMode('auto')">
                        <div class="mode-icon">🤖</div>
                        <div class="mode-name" data-lang="autoMode">自动模式</div>
                        <div class="mode-desc" data-lang="autoModeDesc">系统根据策略自动控制</div>
                    </div>
                    <div class="mode-option" onclick="selectMode('manual')">
                        <div class="mode-icon">👆</div>
                        <div class="mode-name" data-lang="manualMode">手动模式</div>
                        <div class="mode-desc" data-lang="manualModeDesc">手动控制充放电操作</div>
                    </div>
                </div>
            </div>

            <!-- 手动控制 -->
            <div class="control-section" id="manualControl" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">🎛️</div>
                        <span data-lang="manualControl">手动控制</span>
                    </h2>
                </div>
                
                <div class="control-buttons">
                    <button class="control-btn charge" onclick="executeControl('charge')">
                        <span class="control-btn-icon">🔋</span>
                        <span data-lang="charge">充电</span>
                    </button>
                    <button class="control-btn discharge" onclick="executeControl('discharge')">
                        <span class="control-btn-icon">⚡</span>
                        <span data-lang="discharge">放电</span>
                    </button>
                    <button class="control-btn stop" onclick="executeControl('stop')">
                        <span class="control-btn-icon">⏹️</span>
                        <span data-lang="stop">停止</span>
                    </button>
                    <button class="control-btn standby" onclick="executeControl('standby')">
                        <span class="control-btn-icon">⏸️</span>
                        <span data-lang="standby">待机</span>
                    </button>
                </div>
            </div>

            <!-- 峰谷套利设置 -->
            <div class="control-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">📈</div>
                        <span data-lang="peakValley">峰谷套利设置</span>
                    </h2>
                </div>
                
                <div class="timeline-container">
                    <div class="timeline-header" data-lang="timeSettings">时间段设置（点击时间块切换峰谷平状态）</div>
                    <div class="timeline">
                        <div class="time-labels">
                            <div class="time-label">0-2</div>
                            <div class="time-label">2-4</div>
                            <div class="time-label">4-6</div>
                            <div class="time-label">6-8</div>
                            <div class="time-label">8-10</div>
                            <div class="time-label">10-12</div>
                            <div class="time-label">12-14</div>
                            <div class="time-label">14-16</div>
                            <div class="time-label">16-18</div>
                            <div class="time-label">18-20</div>
                            <div class="time-label">20-22</div>
                            <div class="time-label">22-24</div>
                        </div>
                        <div class="time-blocks" id="timeBlocks">
                            <!-- 时间块将通过JavaScript生成 -->
                        </div>
                    </div>
                    <div class="timeline-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #fee2e2;"></div>
                            <span data-lang="peak">峰值时段</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #dbeafe;"></div>
                            <span data-lang="valley">谷值时段</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f3f4f6;"></div>
                            <span data-lang="normal">平价时段</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 电池参数设置 -->
            <div class="control-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">🔋</div>
                        <span data-lang="batteryParams">电池参数设置</span>
                    </h2>
                </div>
                
                <div class="param-grid">
                    <div class="param-item">
                        <label class="param-label" data-lang="chargeStopSOC">充电停止SOC</label>
                        <div class="input-wrapper">
                            <input type="number" class="param-input" id="chargeStopSOC" value="95" min="0" max="100">
                            <span class="param-unit">%</span>
                        </div>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="chargePower">充电功率</label>
                        <div class="input-wrapper">
                            <input type="number" class="param-input" id="chargePower" value="250" min="0" max="500">
                            <span class="param-unit">kW</span>
                        </div>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="dischargeStopSOC">放电停止SOC</label>
                        <div class="input-wrapper">
                            <input type="number" class="param-input" id="dischargeStopSOC" value="10" min="0" max="100">
                            <span class="param-unit">%</span>
                        </div>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="dischargePower">放电功率</label>
                        <div class="input-wrapper">
                            <input type="number" class="param-input" id="dischargePower" value="250" min="0" max="500">
                            <span class="param-unit">kW</span>
                        </div>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="balanceControl">均衡控制</label>
                        <select class="param-input" id="balanceControl">
                            <option value="active" data-lang="activeBalance">主动均衡</option>
                            <option value="passive" data-lang="passiveBalance">被动均衡</option>
                        </select>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="fanControl">风扇控制</label>
                        <select class="param-input" id="fanControl">
                            <option value="auto" data-lang="auto">自动</option>
                            <option value="on" data-lang="on">开启</option>
                            <option value="off" data-lang="off">关闭</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 消防控制 -->
            <div class="control-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">🚨</div>
                        <span data-lang="fireControl">消防控制</span>
                    </h2>
                </div>
                
                <div class="param-grid">
                    <div class="param-item">
                        <label class="param-label" data-lang="fireStartMode">灭火启动</label>
                        <select class="param-input" id="fireStartMode">
                            <option value="auto" data-lang="autoStart">自动启动</option>
                            <option value="manual" data-lang="manualStart">手动启动</option>
                        </select>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="fireAgent">灭火剂类型</label>
                        <select class="param-input" id="fireAgent">
                            <option value="perfluorohexanone" data-lang="perfluorohexanone">全氟己酮</option>
                            <option value="heptafluoropropane" data-lang="heptafluoropropane">七氟丙烷</option>
                        </select>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="alarmSound">声光报警</label>
                        <select class="param-input" id="alarmSound">
                            <option value="enable" data-lang="enable">启用</option>
                            <option value="disable" data-lang="disable">禁用</option>
                        </select>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="emergencyPower">紧急断电</label>
                        <select class="param-input" id="emergencyPower">
                            <option value="auto" data-lang="auto">自动</option>
                            <option value="manual" data-lang="manual">手动</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 操作按钮 -->
            <div class="action-buttons">
                <button class="action-btn secondary" onclick="resetSettings()">
                    <span data-lang="reset">重置默认</span>
                </button>
                <button class="action-btn primary" onclick="saveSettings()">
                    <span data-lang="save">保存设置</span>
                </button>
            </div>
        </main>
    </div>

    <!-- 确认对话框 -->
    <div class="confirm-dialog" id="confirmDialog">
        <div class="confirm-content">
            <h3 class="confirm-title" id="confirmTitle">确认操作</h3>
            <p class="confirm-message" id="confirmMessage">确定要执行此操作吗？</p>
            <div class="confirm-buttons">
                <button class="confirm-btn cancel" onclick="closeConfirm()">
                    <span data-lang="cancel">取消</span>
                </button>
                <button class="confirm-btn confirm" onclick="confirmAction()">
                    <span data-lang="confirm">确认</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // 语言配置
        const translations = {
            zh: {
                systemName: '储能柜管理系统',
                status: '运行正常',
                theme: '主题',
                language: '语言',
                navHome: '首页',
                navParams: '设备参数',
                navControl: '设备控制',
                navAlarms: '告警',
                navSettings: '设置',
                autoModeRunning: '系统正在自动模式下运行，根据峰谷套利策略自动控制充放电',
                runMode: '运行模式',
                autoMode: '自动模式',
                autoModeDesc: '系统根据策略自动控制',
                manualMode: '手动模式',
                manualModeDesc: '手动控制充放电操作',
                manualControl: '手动控制',
                charge: '充电',
                discharge: '放电',
                stop: '停止',
                standby: '待机',
                peakValley: '峰谷套利设置',
                timeSettings: '时间段设置（点击时间块切换峰谷平状态）',
                peak: '峰值时段',
                valley: '谷值时段',
                normal: '平价时段',
                batteryParams: '电池参数设置',
                chargeStopSOC: '充电停止SOC',
                chargePower: '充电功率',
                dischargeStopSOC: '放电停止SOC',
                dischargePower: '放电功率',
                balanceControl: '均衡控制',
                activeBalance: '主动均衡',
                passiveBalance: '被动均衡',
                fanControl: '风扇控制',
                auto: '自动',
                on: '开启',
                off: '关闭',
                fireControl: '消防控制',
                fireStartMode: '灭火启动',
                autoStart: '自动启动',
                manualStart: '手动启动',
                fireAgent: '灭火剂类型',
                perfluorohexanone: '全氟己酮',
                heptafluoropropane: '七氟丙烷',
                alarmSound: '声光报警',
                enable: '启用',
                disable: '禁用',
                emergencyPower: '紧急断电',
                manual: '手动',
                reset: '重置默认',
                save: '保存设置',
                cancel: '取消',
                confirm: '确认',
                confirmSave: '确认保存',
                confirmSaveMsg: '确定要保存当前设置吗？',
                confirmReset: '确认重置',
                confirmResetMsg: '确定要重置为默认设置吗？所有修改将丢失。',
                confirmCharge: '确认充电',
                confirmChargeMsg: '确定要开始充电吗？',
                confirmDischarge: '确认放电',
                confirmDischargeMsg: '确定要开始放电吗？',
                confirmStop: '确认停止',
                confirmStopMsg: '确定要停止当前操作吗？',
                confirmStandby: '确认待机',
                confirmStandbyMsg: '确定要进入待机模式吗？',
                saveSuccess: '设置已保存',
                resetSuccess: '已重置为默认设置',
                controlSuccess: '控制指令已发送'
            },
            en: {
                systemName: 'Energy Storage System',
                status: 'Running Normal',
                theme: 'Theme',
                language: 'Language',
                navHome: 'Home',
                navParams: 'Parameters',
                navControl: 'Control',
                navAlarms: 'Alarms',
                navSettings: 'Settings',
                autoModeRunning: 'System is running in automatic mode, controlling charge/discharge based on peak-valley arbitrage strategy',
                runMode: 'Run Mode',
                autoMode: 'Auto Mode',
                autoModeDesc: 'System controls automatically',
                manualMode: 'Manual Mode',
                manualModeDesc: 'Manual charge/discharge control',
                manualControl: 'Manual Control',
                charge: 'Charge',
                discharge: 'Discharge',
                stop: 'Stop',
                standby: 'Standby',
                peakValley: 'Peak-Valley Arbitrage Settings',
                timeSettings: 'Time Period Settings (Click blocks to switch peak/valley/normal)',
                peak: 'Peak Period',
                valley: 'Valley Period',
                normal: 'Normal Period',
                batteryParams: 'Battery Parameters',
                chargeStopSOC: 'Charge Stop SOC',
                chargePower: 'Charge Power',
                dischargeStopSOC: 'Discharge Stop SOC',
                dischargePower: 'Discharge Power',
                balanceControl: 'Balance Control',
                activeBalance: 'Active Balance',
                passiveBalance: 'Passive Balance',
                fanControl: 'Fan Control',
                auto: 'Auto',
                on: 'On',
                off: 'Off',
                fireControl: 'Fire Control',
                fireStartMode: 'Fire Start Mode',
                autoStart: 'Auto Start',
                manualStart: 'Manual Start',
                fireAgent: 'Fire Agent Type',
                perfluorohexanone: 'Perfluorohexanone',
                heptafluoropropane: 'Heptafluoropropane',
                alarmSound: 'Sound & Light Alarm',
                enable: 'Enable',
                disable: 'Disable',
                emergencyPower: 'Emergency Power Off',
                manual: 'Manual',
                reset: 'Reset Default',
                save: 'Save Settings',
                cancel: 'Cancel',
                confirm: 'Confirm',
                confirmSave: 'Confirm Save',
                confirmSaveMsg: 'Are you sure you want to save current settings?',
                confirmReset: 'Confirm Reset',
                confirmResetMsg: 'Are you sure you want to reset to default settings? All changes will be lost.',
                confirmCharge: 'Confirm Charge',
                confirmChargeMsg: 'Are you sure you want to start charging?',
                confirmDischarge: 'Confirm Discharge',
                confirmDischargeMsg: 'Are you sure you want to start discharging?',
                confirmStop: 'Confirm Stop',
                confirmStopMsg: 'Are you sure you want to stop current operation?',
                confirmStandby: 'Confirm Standby',
                confirmStandbyMsg: 'Are you sure you want to enter standby mode?',
                saveSuccess: 'Settings saved',
                resetSuccess: 'Reset to default settings',
                controlSuccess: 'Control command sent'
            }
        };

        let currentLang = localStorage.getItem('touchscreen_lang') || 'zh';
        let currentTheme = localStorage.getItem('touchscreen_theme') || 'light';
        let currentMode = 'auto';
        let pendingAction = null;

        // 时间段配置 (0-23小时，每个小时的状态)
        let timeBlockStates = [
            'valley', 'valley', 'valley', 'valley', 'valley', 'valley', // 0-5
            'normal', 'normal', 'peak', 'peak', 'peak', 'normal',       // 6-11
            'normal', 'normal', 'normal', 'normal', 'normal', 'normal', // 12-17
            'peak', 'peak', 'peak', 'normal', 'valley', 'valley'        // 18-23
        ];

        // 更新时间
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeStr;
        }

        // 切换语言
        function switchLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            localStorage.setItem('touchscreen_lang', currentLang);
            applyLanguage();
        }

        // 应用语言
        function applyLanguage() {
            document.querySelectorAll('[data-lang]').forEach(elem => {
                const key = elem.getAttribute('data-lang');
                if (translations[currentLang][key]) {
                    elem.textContent = translations[currentLang][key];
                }
            });
        }

        // 切换主题
        function switchTheme() {
            // 显示主题选择器
            if (window.ThemeManager) {
                ThemeManager.showThemePicker();
            }
        }

        // 应用主题
        function applyTheme() {
            // 使用 ThemeManager 处理主题
            const theme = localStorage.getItem('touchscreen_theme') || 'light';
            if (window.ThemeManager) {
                ThemeManager.applyTheme(theme);
            }
        }


        // 选择运行模式
        function selectMode(mode) {
            currentMode = mode;
            
            // 更新模式选项状态
            document.querySelectorAll('.mode-option').forEach(option => {
                option.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // 显示/隐藏手动控制区域
            const manualControl = document.getElementById('manualControl');
            const statusBanner = document.getElementById('statusBanner');
            
            if (mode === 'manual') {
                manualControl.style.display = 'block';
                statusBanner.innerHTML = '<span>⚠️</span><span>' + 
                    (currentLang === 'zh' ? '系统已切换到手动模式，请谨慎操作' : 'System switched to manual mode, please operate carefully') + 
                    '</span>';
                statusBanner.className = 'status-banner warning';
            } else {
                manualControl.style.display = 'none';
                statusBanner.innerHTML = '<span>ℹ️</span><span>' + 
                    translations[currentLang].autoModeRunning + 
                    '</span>';
                statusBanner.className = 'status-banner';
            }
        }

        // 执行控制命令
        function executeControl(action) {
            let title, message;
            
            switch(action) {
                case 'charge':
                    title = translations[currentLang].confirmCharge;
                    message = translations[currentLang].confirmChargeMsg;
                    break;
                case 'discharge':
                    title = translations[currentLang].confirmDischarge;
                    message = translations[currentLang].confirmDischargeMsg;
                    break;
                case 'stop':
                    title = translations[currentLang].confirmStop;
                    message = translations[currentLang].confirmStopMsg;
                    break;
                case 'standby':
                    title = translations[currentLang].confirmStandby;
                    message = translations[currentLang].confirmStandbyMsg;
                    break;
            }
            
            pendingAction = () => {
                // 模拟发送控制命令
                console.log('Executing control:', action);
                showNotification(translations[currentLang].controlSuccess, 'success');
                
                // 更新状态显示
                updateControlStatus(action);
            };
            
            showConfirm(title, message);
        }

        // 更新控制状态
        function updateControlStatus(action) {
            const statusBanner = document.getElementById('statusBanner');
            let statusText = '';
            
            switch(action) {
                case 'charge':
                    statusText = currentLang === 'zh' ? '设备正在充电中...' : 'Device is charging...';
                    break;
                case 'discharge':
                    statusText = currentLang === 'zh' ? '设备正在放电中...' : 'Device is discharging...';
                    break;
                case 'stop':
                    statusText = currentLang === 'zh' ? '设备已停止运行' : 'Device has stopped';
                    break;
                case 'standby':
                    statusText = currentLang === 'zh' ? '设备处于待机状态' : 'Device is in standby mode';
                    break;
            }
            
            statusBanner.innerHTML = '<span>ℹ️</span><span>' + statusText + '</span>';
            statusBanner.className = 'status-banner';
        }

        // 初始化时间块
        function initTimeBlocks() {
            const timeBlocksContainer = document.getElementById('timeBlocks');
            timeBlocksContainer.innerHTML = '';
            
            // 创建12个2小时的时间块
            for (let i = 0; i < 12; i++) {
                const block = document.createElement('div');
                block.className = 'time-block';
                block.dataset.index = i;
                
                // 根据两个小时的状态决定时间块颜色
                const hour1State = timeBlockStates[i * 2];
                const hour2State = timeBlockStates[i * 2 + 1];
                
                // 如果两个小时状态相同，使用该状态；否则默认为normal
                if (hour1State === hour2State) {
                    block.classList.add(hour1State);
                } else {
                    block.classList.add('normal');
                }
                
                block.onclick = () => toggleTimeBlock(i);
                timeBlocksContainer.appendChild(block);
            }
        }

        // 切换时间块状态
        function toggleTimeBlock(index) {
            const block = document.querySelector(`.time-block[data-index="${index}"]`);
            const states = ['valley', 'normal', 'peak'];
            
            // 获取当前状态
            let currentState = 'normal';
            states.forEach(state => {
                if (block.classList.contains(state)) {
                    currentState = state;
                }
            });
            
            // 切换到下一个状态
            const currentIndex = states.indexOf(currentState);
            const nextIndex = (currentIndex + 1) % states.length;
            const nextState = states[nextIndex];
            
            // 更新样式
            states.forEach(state => block.classList.remove(state));
            block.classList.add(nextState);
            
            // 更新状态数组
            timeBlockStates[index * 2] = nextState;
            timeBlockStates[index * 2 + 1] = nextState;
        }

        // 保存设置
        function saveSettings() {
            pendingAction = () => {
                // 收集所有设置
                const settings = {
                    chargeStopSOC: document.getElementById('chargeStopSOC').value,
                    chargePower: document.getElementById('chargePower').value,
                    dischargeStopSOC: document.getElementById('dischargeStopSOC').value,
                    dischargePower: document.getElementById('dischargePower').value,
                    balanceControl: document.getElementById('balanceControl').value,
                    fanControl: document.getElementById('fanControl').value,
                    fireStartMode: document.getElementById('fireStartMode').value,
                    fireAgent: document.getElementById('fireAgent').value,
                    alarmSound: document.getElementById('alarmSound').value,
                    emergencyPower: document.getElementById('emergencyPower').value,
                    timeBlockStates: timeBlockStates
                };
                
                // 保存到本地存储
                localStorage.setItem('touchscreen_control_settings', JSON.stringify(settings));
                
                showNotification(translations[currentLang].saveSuccess, 'success');
            };
            
            showConfirm(
                translations[currentLang].confirmSave,
                translations[currentLang].confirmSaveMsg
            );
        }

        // 重置设置
        function resetSettings() {
            pendingAction = () => {
                // 重置表单值
                document.getElementById('chargeStopSOC').value = '95';
                document.getElementById('chargePower').value = '250';
                document.getElementById('dischargeStopSOC').value = '10';
                document.getElementById('dischargePower').value = '250';
                document.getElementById('balanceControl').value = 'active';
                document.getElementById('fanControl').value = 'auto';
                document.getElementById('fireStartMode').value = 'auto';
                document.getElementById('fireAgent').value = 'perfluorohexanone';
                document.getElementById('alarmSound').value = 'enable';
                document.getElementById('emergencyPower').value = 'auto';
                
                // 重置时间块
                timeBlockStates = [
                    'valley', 'valley', 'valley', 'valley', 'valley', 'valley',
                    'normal', 'normal', 'peak', 'peak', 'peak', 'normal',
                    'normal', 'normal', 'normal', 'normal', 'normal', 'normal',
                    'peak', 'peak', 'peak', 'normal', 'valley', 'valley'
                ];
                initTimeBlocks();
                
                showNotification(translations[currentLang].resetSuccess, 'success');
            };
            
            showConfirm(
                translations[currentLang].confirmReset,
                translations[currentLang].confirmResetMsg
            );
        }

        // 显示确认对话框
        function showConfirm(title, message) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmDialog').style.display = 'flex';
        }

        // 关闭确认对话框
        function closeConfirm() {
            document.getElementById('confirmDialog').style.display = 'none';
            pendingAction = null;
        }

        // 确认操作
        function confirmAction() {
            if (pendingAction) {
                pendingAction();
            }
            closeConfirm();
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            // 简单的通知实现，可以根据需要增强
            const statusBanner = document.getElementById('statusBanner');
            const originalContent = statusBanner.innerHTML;
            const originalClass = statusBanner.className;
            
            statusBanner.innerHTML = '<span>✓</span><span>' + message + '</span>';
            statusBanner.className = 'status-banner ' + (type === 'success' ? '' : type);
            
            // 3秒后恢复原状
            setTimeout(() => {
                statusBanner.innerHTML = originalContent;
                statusBanner.className = originalClass;
            }, 3000);
        }

        // 加载保存的设置
        function loadSettings() {
            const savedSettings = localStorage.getItem('touchscreen_control_settings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                // 恢复表单值
                if (settings.chargeStopSOC) document.getElementById('chargeStopSOC').value = settings.chargeStopSOC;
                if (settings.chargePower) document.getElementById('chargePower').value = settings.chargePower;
                if (settings.dischargeStopSOC) document.getElementById('dischargeStopSOC').value = settings.dischargeStopSOC;
                if (settings.dischargePower) document.getElementById('dischargePower').value = settings.dischargePower;
                if (settings.balanceControl) document.getElementById('balanceControl').value = settings.balanceControl;
                if (settings.fanControl) document.getElementById('fanControl').value = settings.fanControl;
                if (settings.fireStartMode) document.getElementById('fireStartMode').value = settings.fireStartMode;
                if (settings.fireAgent) document.getElementById('fireAgent').value = settings.fireAgent;
                if (settings.alarmSound) document.getElementById('alarmSound').value = settings.alarmSound;
                if (settings.emergencyPower) document.getElementById('emergencyPower').value = settings.emergencyPower;
                
                // 恢复时间块状态
                if (settings.timeBlockStates) {
                    timeBlockStates = settings.timeBlockStates;
                }
            }
        }

        // 页面加载完成后初始化
        window.onload = function() {
            // 检查登录状态
            const user = localStorage.getItem('touchscreen_user') || sessionStorage.getItem('touchscreen_user');
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            // 应用保存的设置
            applyLanguage();
            applyTheme();
            
            // 加载保存的设置
            loadSettings();
            
            // 初始化时间块
            initTimeBlocks();

            // 更新时间
            updateTime();
            setInterval(updateTime, 1000);
        };
    </script>
    <script src="theme-manager.js"></script>
    <script src="tech-ui-enhancement.js"></script>
</body>
</html>