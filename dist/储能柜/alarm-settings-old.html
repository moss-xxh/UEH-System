<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>告警设置 - 储能柜管理系统</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* 页面布局 */
        .main-content {
            height: calc(100vh - 60px);
            overflow-y: auto;
            padding: 20px;
        }

        /* 告警设置页面样式 */
        .alarm-settings-container {
            display: grid;
            grid-template-columns: 240px 1fr;
            gap: 24px;
            height: calc(100vh - 120px);
        }

        /* 左侧导航 - 使用统一的卡片样式 */
        .alarm-nav {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 24px;
            overflow-y: auto;
            height: 100%;
        }

        [data-theme="dark"] .alarm-nav {
            background: #1e293b;
        }

        .alarm-nav-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .alarm-nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }

        .alarm-nav-item:hover {
            background: #f3f4f6;
            color: var(--text-primary);
        }

        [data-theme="dark"] .alarm-nav-item:hover {
            background: #334155;
        }

        .alarm-nav-item.active {
            background: var(--primary-color);
            color: white;
        }

        .alarm-nav-item i {
            width: 20px;
            text-align: center;
        }

        /* 右侧内容区 - 使用统一的卡片样式 */
        .alarm-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 24px;
            overflow-y: auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        [data-theme="dark"] .alarm-content {
            background: #1e293b;
        }

        .alarm-content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .alarm-content-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* 告警参数表格 */
        .alarm-params-table {
            width: 100%;
            border-collapse: collapse;
        }

        .alarm-params-table th {
            text-align: left;
            padding: 12px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 14px;
        }

        [data-theme="dark"] .alarm-params-table th {
            background: #0f172a;
            border-bottom-color: #334155;
        }

        .alarm-params-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            vertical-align: middle;
        }

        [data-theme="dark"] .alarm-params-table td {
            border-bottom-color: #334155;
        }

        /* 参数输入框 */
        .param-input {
            width: 120px;
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }

        [data-theme="dark"] .param-input {
            background: #0f172a;
            border-color: #334155;
            color: #e2e8f0;
        }

        .param-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* 单位标签 */
        .unit-label {
            margin-left: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* 级别选择 */
        .level-select {
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        [data-theme="dark"] .level-select {
            background: #0f172a;
            border-color: #334155;
            color: #e2e8f0;
        }

        /* 开关组件 */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e5e7eb;
            transition: .4s;
            border-radius: 24px;
        }

        .switch-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .switch-slider {
            background-color: var(--primary-color);
        }

        input:checked + .switch-slider:before {
            transform: translateX(24px);
        }

        /* 设备选择模态框 */
        .device-select-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .device-select-content {
            background: white;
            border-radius: 12px;
            width: 600px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        [data-theme="dark"] .device-select-content {
            background: #1e293b;
        }

        .device-select-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        [data-theme="dark"] .device-select-header {
            border-bottom-color: #334155;
        }

        .device-select-body {
            padding: 20px 24px;
            overflow-y: auto;
            flex: 1;
        }

        .device-select-footer {
            padding: 16px 24px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        [data-theme="dark"] .device-select-footer {
            border-top-color: #334155;
        }

        /* 站点选择 */
        .site-select-group {
            margin-bottom: 20px;
        }

        .site-select-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        .site-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        [data-theme="dark"] .site-select {
            background: #0f172a;
            border-color: #334155;
            color: #e2e8f0;
        }

        /* 设备列表 */
        .device-list {
            display: grid;
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
            padding: 4px;
        }

        .device-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        [data-theme="dark"] .device-item {
            border-color: #334155;
        }

        .device-item:hover {
            background: #f9fafb;
            border-color: var(--primary-color);
        }

        [data-theme="dark"] .device-item:hover {
            background: #0f172a;
        }

        .device-item.selected {
            background: #eff6ff;
            border-color: var(--primary-color);
        }

        [data-theme="dark"] .device-item.selected {
            background: #1e3a8a;
        }

        .device-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .device-info {
            flex: 1;
        }

        .device-name {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .device-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* 操作按钮 */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
        }

        [data-theme="dark"] .action-buttons {
            border-top-color: #334155;
        }

        /* 提示信息 */
        .info-message {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        [data-theme="dark"] .info-message {
            background: #1e3a8a;
            border-color: #2563eb;
        }

        .info-message i {
            color: #3b82f6;
            font-size: 20px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .alarm-settings-container {
                grid-template-columns: 1fr;
            }

            .alarm-nav {
                display: none;
            }

            .param-input {
                width: 100px;
            }
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="header-left">
            <button class="menu-trigger" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <img src="logo.png" alt="AlwaysControl Technology" />
            </div>
        </div>
        
        <div class="header-right">
            <button class="theme-btn" onclick="toggleTheme()" title="切换主题">
                <i class="fas fa-moon" id="headerThemeIcon"></i>
            </button>
            <button class="lang-btn" onclick="toggleLanguage()" title="切换语言">
                <i class="fas fa-globe"></i>
            </button>
            <div class="notification-badge">
                <i class="fas fa-bell" style="font-size: 18px; color: var(--text-secondary);"></i>
            </div>
            <div class="user-menu" onclick="logout()">
                <div class="avatar">A</div>
                <span class="user-name" id="userName">管理员</span>
            </div>
        </div>
    </header>

    <!-- 侧边栏 -->
    <nav class="sidebar" id="sidebar">
        <div class="menu">
            <a href="dashboard.html" class="menu-item" data-menu="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span id="menuDashboard">仪表盘</span>
            </a>
            <a href="site1.html" class="menu-item" data-menu="site1">
                <i class="fas fa-building"></i>
                <span>站点管理</span>
            </a>
            <a href="devices.html" class="menu-item" data-menu="devices">
                <i class="fas fa-database"></i>
                <span id="menuDevices">设备管理</span>
            </a>
            <a href="alarm-settings.html" class="menu-item active" data-menu="alarm-settings">
                <i class="fas fa-bell-slash"></i>
                <span>告警设置</span>
            </a>
            <a href="alarm-management.html" class="menu-item" data-menu="alarm-management">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="menuAlarms">告警管理</span>
            </a>
            <a href="alarm-rules.html" class="menu-item" data-menu="alarm-rules">
                <i class="fas fa-list-check"></i>
                <span>告警规则</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-chart-bar"></i>
                <span id="menuReports">报告中心</span>
            </a>
            <a href="system-management.html" class="menu-item" data-menu="system-management">
                <i class="fas fa-cogs"></i>
                <span id="menuSystem">系统管理</span>
            </a>
        </div>
    </nav>

    <!-- 主内容区域 -->
    <main class="main-content" id="mainContent">
        <div class="page-header" style="margin-bottom: 20px;">
            <h1 class="page-title" style="font-size: 24px; font-weight: 600; color: var(--text-primary); margin: 0;">告警设置</h1>
        </div>

        <div class="alarm-settings-container">
            <!-- 左侧导航 -->
            <div class="alarm-nav">
                <div class="alarm-nav-title">告警类型</div>
                <div class="alarm-nav-item active" onclick="switchAlarmType('battery')">
                    <i class="fas fa-battery-three-quarters"></i>
                    <span>电池系统告警</span>
                </div>
                <div class="alarm-nav-item" onclick="switchAlarmType('pcs')">
                    <i class="fas fa-bolt"></i>
                    <span>PCS告警</span>
                </div>
                <div class="alarm-nav-item" onclick="switchAlarmType('bms')">
                    <i class="fas fa-microchip"></i>
                    <span>BMS告警</span>
                </div>
                <div class="alarm-nav-item" onclick="switchAlarmType('temperature')">
                    <i class="fas fa-thermometer-half"></i>
                    <span>温控系统告警</span>
                </div>
                <div class="alarm-nav-item" onclick="switchAlarmType('fire')">
                    <i class="fas fa-fire-extinguisher"></i>
                    <span>消防系统告警</span>
                </div>
                <div class="alarm-nav-item" onclick="switchAlarmType('power')">
                    <i class="fas fa-plug"></i>
                    <span>配电系统告警</span>
                </div>
                <div class="alarm-nav-item" onclick="switchAlarmType('communication')">
                    <i class="fas fa-wifi"></i>
                    <span>通信系统告警</span>
                </div>
            </div>

            <!-- 右侧内容区 -->
            <div class="alarm-content">
                <div class="alarm-content-header">
                    <h2 class="alarm-content-title" id="alarmTypeTitle">电池系统告警</h2>
                    <button class="btn btn-primary" onclick="showDeviceSelectModal()" style="height: 40px; padding: 0 16px; background: #3562E3;">
                        <i class="fas fa-check-square"></i>
                        选择应用设备
                    </button>
                </div>

                <div class="info-message">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <div style="font-weight: 500; margin-bottom: 4px;">当前应用范围</div>
                        <div style="font-size: 14px; color: var(--text-secondary);" id="appliedDevicesInfo">
                            已选择 5 台设备
                        </div>
                    </div>
                </div>

                <!-- 电池系统告警参数 -->
                <div id="batteryAlarms" class="alarm-params-section">
                    <table class="alarm-params-table">
                        <thead>
                            <tr>
                                <th style="width: 30%">告警项目</th>
                                <th style="width: 25%">预警值</th>
                                <th style="width: 25%">告警值</th>
                                <th style="width: 10%">级别</th>
                                <th style="width: 10%">启用</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div style="font-weight: 500;">单体过压</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">单体电池电压过高</div>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="3.65" step="0.01">
                                    <span class="unit-label">V</span>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="3.75" step="0.01">
                                    <span class="unit-label">V</span>
                                </td>
                                <td>
                                    <select class="level-select">
                                        <option value="critical">严重</option>
                                        <option value="major">重要</option>
                                        <option value="minor">一般</option>
                                    </select>
                                </td>
                                <td>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="font-weight: 500;">单体欠压</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">单体电池电压过低</div>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="2.5" step="0.01">
                                    <span class="unit-label">V</span>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="2.3" step="0.01">
                                    <span class="unit-label">V</span>
                                </td>
                                <td>
                                    <select class="level-select">
                                        <option value="critical">严重</option>
                                        <option value="major">重要</option>
                                        <option value="minor">一般</option>
                                    </select>
                                </td>
                                <td>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="font-weight: 500;">充电过温</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">充电时温度过高</div>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="50" step="1">
                                    <span class="unit-label">°C</span>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="55" step="1">
                                    <span class="unit-label">°C</span>
                                </td>
                                <td>
                                    <select class="level-select">
                                        <option value="critical">严重</option>
                                        <option value="major" selected>重要</option>
                                        <option value="minor">一般</option>
                                    </select>
                                </td>
                                <td>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="font-weight: 500;">放电过温</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">放电时温度过高</div>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="55" step="1">
                                    <span class="unit-label">°C</span>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="60" step="1">
                                    <span class="unit-label">°C</span>
                                </td>
                                <td>
                                    <select class="level-select">
                                        <option value="critical">严重</option>
                                        <option value="major" selected>重要</option>
                                        <option value="minor">一般</option>
                                    </select>
                                </td>
                                <td>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="font-weight: 500;">充电低温</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">充电时温度过低</div>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="5" step="1">
                                    <span class="unit-label">°C</span>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="0" step="1">
                                    <span class="unit-label">°C</span>
                                </td>
                                <td>
                                    <select class="level-select">
                                        <option value="critical">严重</option>
                                        <option value="major" selected>重要</option>
                                        <option value="minor">一般</option>
                                    </select>
                                </td>
                                <td>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="font-weight: 500;">SOC过低</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">电池剩余电量过低</div>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="20" step="1">
                                    <span class="unit-label">%</span>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="10" step="1">
                                    <span class="unit-label">%</span>
                                </td>
                                <td>
                                    <select class="level-select">
                                        <option value="critical">严重</option>
                                        <option value="major">重要</option>
                                        <option value="minor" selected>一般</option>
                                    </select>
                                </td>
                                <td>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="font-weight: 500;">SOH异常</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">电池健康度下降</div>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="85" step="1">
                                    <span class="unit-label">%</span>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="80" step="1">
                                    <span class="unit-label">%</span>
                                </td>
                                <td>
                                    <select class="level-select">
                                        <option value="critical">严重</option>
                                        <option value="major">重要</option>
                                        <option value="minor" selected>一般</option>
                                    </select>
                                </td>
                                <td>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="font-weight: 500;">电压差异</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">单体电压最大差值</div>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="0.05" step="0.01">
                                    <span class="unit-label">V</span>
                                </td>
                                <td>
                                    <input type="number" class="param-input" value="0.1" step="0.01">
                                    <span class="unit-label">V</span>
                                </td>
                                <td>
                                    <select class="level-select">
                                        <option value="critical">严重</option>
                                        <option value="major">重要</option>
                                        <option value="minor" selected>一般</option>
                                    </select>
                                </td>
                                <td>
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 其他告警类型内容（默认隐藏） -->
                <div id="pcsAlarms" class="alarm-params-section" style="display: none;">
                    <!-- PCS告警参数内容 -->
                </div>

                <div id="bmsAlarms" class="alarm-params-section" style="display: none;">
                    <!-- BMS告警参数内容 -->
                </div>

                <!-- 操作按钮 -->
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="saveAlarmSettings()">
                        <i class="fas fa-save"></i>
                        保存设置
                    </button>
                    <button class="btn btn-secondary" onclick="resetAlarmSettings()">
                        <i class="fas fa-undo"></i>
                        恢复默认
                    </button>
                    <button class="btn btn-secondary" onclick="exportAlarmSettings()">
                        <i class="fas fa-download"></i>
                        导出配置
                    </button>
                    <button class="btn btn-secondary" onclick="importAlarmSettings()">
                        <i class="fas fa-upload"></i>
                        导入配置
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- 设备选择模态框 -->
    <div class="device-select-modal" id="deviceSelectModal">
        <div class="device-select-content">
            <div class="device-select-header">
                <h3 style="margin: 0; font-size: 18px;">选择应用设备</h3>
                <button class="btn-icon" onclick="closeDeviceSelectModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="device-select-body">
                <div class="site-select-group">
                    <label class="site-select-label">选择站点</label>
                    <select class="site-select" onchange="filterDevicesBySite(this.value)">
                        <option value="all">全部站点</option>
                        <option value="site1">科技园区站</option>
                        <option value="site2">工业园区站</option>
                        <option value="site3">商业中心站</option>
                    </select>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="selectAllDevices" onchange="toggleAllDevices(this.checked)">
                        <span style="font-size: 14px;">全选设备</span>
                    </label>
                </div>
                <div class="device-list" id="deviceList">
                    <!-- 设备列表动态生成 -->
                </div>
            </div>
            <div class="device-select-footer">
                <button class="btn btn-secondary" onclick="closeDeviceSelectModal()">取消</button>
                <button class="btn btn-primary" onclick="applyDeviceSelection()">
                    <i class="fas fa-check"></i>
                    确认选择
                </button>
            </div>
        </div>
    </div>

    <!-- 移动端遮罩 -->
    <div id="mobileOverlay" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 998;" onclick="closeMobileSidebar()"></div>

    <script src="common.js"></script>
    <script src="notification-fix.js"></script>
    <script>
        // 检查登录状态
        checkAuth();
        
        // 设置当前页面菜单项
        setActiveMenuItem('alarm-settings');

        // 当前选中的告警类型
        let currentAlarmType = 'battery';

        // 选中的设备列表
        let selectedDevices = new Set(['ESS001', 'ESS002', 'ESS003', 'ESS004', 'ESS005']);

        // 设备数据
        const devices = [
            { id: 'ESS001', name: '储能柜#1', site: 'site1', siteNam

e: '科技园区站', status: '运行中' },
            { id: 'ESS002', name: '储能柜#2', site: 'site1', siteName: '科技园区站', status: '运行中' },
            { id: 'ESS003', name: '储能柜#3', site: 'site1', siteName: '科技园区站', status: '待机' },
            { id: 'ESS004', name: '储能柜#4', site: 'site2', siteName: '工业园区站', status: '运行中' },
            { id: 'ESS005', name: '储能柜#5', site: 'site2', siteName: '工业园区站', status: '充电中' },
            { id: 'ESS006', name: '储能柜#6', site: 'site2', siteName: '工业园区站', status: '放电中' },
            { id: 'ESS007', name: '储能柜#7', site: 'site3', siteName: '商业中心站', status: '运行中' },
            { id: 'ESS008', name: '储能柜#8', site: 'site3', siteName: '商业中心站', status: '离线' }
        ];

        // 切换告警类型
        function switchAlarmType(type) {
            currentAlarmType = type;
            
            // 更新导航激活状态
            document.querySelectorAll('.alarm-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.alarm-nav-item').classList.add('active');
            
            // 更新标题
            const titles = {
                'battery': '电池系统告警',
                'pcs': 'PCS告警',
                'bms': 'BMS告警',
                'temperature': '温控系统告警',
                'fire': '消防系统告警',
                'power': '配电系统告警',
                'communication': '通信系统告警'
            };
            document.getElementById('alarmTypeTitle').textContent = titles[type];
            
            // 切换内容（这里仅显示电池系统的内容作为示例）
            document.querySelectorAll('.alarm-params-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // 显示对应的告警参数（需要为其他类型创建相应的内容）
            const sectionId = type + 'Alarms';
            const section = document.getElementById(sectionId);
            if (section) {
                section.style.display = 'block';
            } else {
                // 如果没有对应的内容，显示电池系统的内容作为示例
                document.getElementById('batteryAlarms').style.display = 'block';
            }
        }

        // 显示设备选择模态框
        function showDeviceSelectModal() {
            document.getElementById('deviceSelectModal').style.display = 'flex';
            renderDeviceList();
        }

        // 关闭设备选择模态框
        function closeDeviceSelectModal() {
            document.getElementById('deviceSelectModal').style.display = 'none';
        }

        // 渲染设备列表
        function renderDeviceList(site = 'all') {
            const deviceList = document.getElementById('deviceList');
            const filteredDevices = site === 'all' ? devices : devices.filter(d => d.site === site);
            
            deviceList.innerHTML = filteredDevices.map(device => `
                <div class="device-item ${selectedDevices.has(device.id) ? 'selected' : ''}" onclick="toggleDevice('${device.id}')">
                    <input type="checkbox" class="device-checkbox" 
                           ${selectedDevices.has(device.id) ? 'checked' : ''} 
                           onclick="event.stopPropagation(); toggleDevice('${device.id}')">
                    <div class="device-info">
                        <div class="device-name">${device.name}</div>
                        <div class="device-details">${device.siteName} | ${device.status}</div>
                    </div>
                </div>
            `).join('');
            
            // 更新全选状态
            const allChecked = filteredDevices.every(d => selectedDevices.has(d.id));
            document.getElementById('selectAllDevices').checked = allChecked;
        }

        // 切换设备选择
        function toggleDevice(deviceId) {
            if (selectedDevices.has(deviceId)) {
                selectedDevices.delete(deviceId);
            } else {
                selectedDevices.add(deviceId);
            }
            renderDeviceList(document.querySelector('.site-select').value);
        }

        // 全选/取消全选
        function toggleAllDevices(checked) {
            const site = document.querySelector('.site-select').value;
            const filteredDevices = site === 'all' ? devices : devices.filter(d => d.site === site);
            
            if (checked) {
                filteredDevices.forEach(device => selectedDevices.add(device.id));
            } else {
                filteredDevices.forEach(device => selectedDevices.delete(device.id));
            }
            renderDeviceList(site);
        }

        // 按站点筛选设备
        function filterDevicesBySite(site) {
            renderDeviceList(site);
        }

        // 应用设备选择
        function applyDeviceSelection() {
            // 更新应用范围显示
            document.getElementById('appliedDevicesInfo').textContent = 
                selectedDevices.size > 0 ? `已选择 ${selectedDevices.size} 台设备` : '未选择设备';
            
            closeDeviceSelectModal();
            
            // 显示成功提示
            showNotification('设备选择已更新', 'success');
        }

        // 保存告警设置
        function saveAlarmSettings() {
            // 收集当前告警类型的所有设置
            const settings = {
                type: currentAlarmType,
                devices: Array.from(selectedDevices),
                parameters: []
            };
            
            // 获取当前显示的参数表格
            const visibleSection = document.querySelector('.alarm-params-section:not([style*="display: none"])');
            if (visibleSection) {
                const rows = visibleSection.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    settings.parameters.push({
                        name: cells[0].querySelector('div').textContent,
                        warningValue: cells[1].querySelector('input').value,
                        alarmValue: cells[2].querySelector('input').value,
                        level: cells[3].querySelector('select').value,
                        enabled: cells[4].querySelector('input').checked
                    });
                });
            }
            
            // 保存到本地存储（实际应用中应该发送到服务器）
            localStorage.setItem(`alarmSettings_${currentAlarmType}`, JSON.stringify(settings));
            
            showNotification('告警设置保存成功', 'success');
        }

        // 恢复默认设置
        function resetAlarmSettings() {
            if (confirm('确定要恢复默认设置吗？当前的修改将会丢失。')) {
                // 重置输入框的值（这里仅作示例）
                const inputs = document.querySelectorAll('.param-input');
                inputs.forEach(input => {
                    // 根据实际默认值设置
                    input.value = input.defaultValue || input.value;
                });
                
                showNotification('已恢复默认设置', 'info');
            }
        }

        // 导出告警设置
        function exportAlarmSettings() {
            // 收集所有告警设置
            const allSettings = {};
            ['battery', 'pcs', 'bms', 'temperature', 'fire', 'power', 'communication'].forEach(type => {
                const saved = localStorage.getItem(`alarmSettings_${type}`);
                if (saved) {
                    allSettings[type] = JSON.parse(saved);
                }
            });
            
            // 创建下载
            const dataStr = JSON.stringify(allSettings, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `告警配置_${new Date().toLocaleDateString()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('配置已导出', 'success');
        }

        // 导入告警设置
        function importAlarmSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = e => {
                    try {
                        const settings = JSON.parse(e.target.result);
                        
                        // 保存导入的设置
                        Object.keys(settings).forEach(type => {
                            localStorage.setItem(`alarmSettings_${type}`, JSON.stringify(settings[type]));
                        });
                        
                        showNotification('配置导入成功', 'success');
                        
                        // 刷新当前页面
                        location.reload();
                    } catch (error) {
                        showNotification('配置文件格式错误', 'error');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            // 创建通知元素
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                display: flex;
                align-items: center;
                gap: 12px;
                z-index: 9999;
                animation: slideIn 0.3s ease;
            `;
            
            // 根据类型设置图标和颜色
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle',
                warning: 'fa-exclamation-triangle'
            };
            
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                info: '#3b82f6',
                warning: '#f59e0b'
            };
            
            notification.innerHTML = `
                <i class="fas ${icons[type]}" style="color: ${colors[type]}; font-size: 20px;"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // 3秒后自动移除
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // 添加动画样式
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 加载保存的设置
            const saved = localStorage.getItem(`alarmSettings_${currentAlarmType}`);
            if (saved) {
                const settings = JSON.parse(saved);
                selectedDevices = new Set(settings.devices);
                document.getElementById('appliedDevicesInfo').textContent = 
                    selectedDevices.size > 0 ? `已选择 ${selectedDevices.size} 台设备` : '未选择设备';
            }
        });
    </script>
</body>
</html>